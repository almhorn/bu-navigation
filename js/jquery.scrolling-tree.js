if(typeof jQuery!=="function")throw"ScrollingTree loaded before jQuery; be sure to load jQuery first.";
(function(b){b.scrollingTree={defaults:{selectedClass:"st-selected",btnTopClass:"st-back-to-top",btnBackClass:"st-back-one",listClass:"st-the-list",btnDisabledClass:"st-disabled",listContainerClass:"st-list-container",breadcrumbsClass:"st-breadcrumbs",drillClass:"st-drill",bcLinkClass:"st-breadcrumb-link",inputName:"st-input",disabledNodeClass:"st-disabled-node",startNode:0,startView:0,disabledNodeIds:[],filterNode:function(){return!0},getNodeId:function(b){return b.id},getNodeName:function(b){return b.name},
getParentId:function(b){return b.parent_id},nodeMarkup:function(b){return b.name},getNumChildren:function(b){return b.num_children}},instances:[]};b.fn.scrollingTree=function(e,d){return this.each(function(){b.scrollingTree.instances.push(new j(b(this),e,d))})};var j=function(e,d,g){this.view=function(a,c){this.current_view=typeof a=="object"?this.getNodeId(a):a;c=="left"&&this.list_container.scrollLeft("fast");c=="right"&&this.list_container.scrollRight("fast");this.draw()};this.draw=function(){this.container.trigger("beforeDraw");
var a,c;this.link_top.addClass(this.opts.btnDisabledClass);this.link_back.addClass(this.opts.btnDisabledClass);this.the_list=b('<ul class="'+this.opts.listClass+'"></ul>');a=b(this.getChildren(this.current_view||0)).filter(this.filterNode);for(c=0;c<a.length;c++){var f=a[c],h=this.getNodeId(f),e=b('<input type="radio"/>').attr({value:h,id:this.opts.inputName+"_"+h}).bind("click",{st:this},this.itemSelected),d=b("<li>").append(e),i;children=this.getChildren(f);i=b("<span>").append(this.nodeMarkup(f));
this.hasChildren(f)&&i.addClass(this.opts.drillClass).bind("click",{st:this,target:d},this.drillDown);d.append(i);this.opts.inputName&&e.attr("name",this.opts.inputName);h==this.getSelection()&&d.addClass(this.opts.selectedClass);d.data("st-value",h);this.the_list.append(d)}this.list_container.html(this.the_list);jQuery("#"+this.opts.inputName+"_"+this.current_selection).attr("checked","checked");a=this.makeBreadcrumbs();this.bc.html("");for(c=0;c<a.length;c++)this.bc.append(a[c]);this.current_view&&
(this.link_back.removeClass(this.opts.btnDisabledClass),this.link_top.removeClass(this.opts.btnDisabledClass));this.container.trigger("afterDraw")};this.makeBreadcrumbs=function(){for(var a=[],c=this.current_view,f=function(a){a.preventDefault();a.data[0].view(a.data[1])},d=null,e=null,g=!0;c;){d=this.getNodeById(c);if(!d)break;e=b("<span>").append(this.getNodeName(d).replace("<","&lt;").replace(">","&gt;"));g||e.addClass(this.opts.bcLinkClass).bind("click",[this,c],f);a.push(e);a.push(b("<span> &gt; </span>"));
c=this.getParentId(d);g=!1}this.current_view?a.push(b("<span>Top</span>").addClass(this.opts.bcLinkClass).bind("click",[this,0],f)):a.push(b("<span>Top</span>"));a.reverse();return a};this.getNodeById=function(a){for(var c=0;c<this.tree.length;c++)if(this.getNodeId(this.tree[c])==a)return this.tree[c];return null};this.getSiblings=function(a){return(a=typeof a=="object"?a:this.getNodeById(a))?this.getChildren(this.getParentId(a)):null};this.isDisabledNode=function(a){for(var a=typeof a=="object"?
this.getNodeId(a):a,c=typeof this.opts.disabledNodeIds.length==="undefined"?[0+this.opts.disabledNodeIds]:this.opts.disabledNodeIds,b=0;b<c.length;b++)if(c[b]==a)return!0;return!1};this.getChildren=function(a){var c=[],a=typeof a=="object"?this.getNodeId(a):a,b;if(a!==null)for(b=0;b<this.tree.length;b++)this.getParentId(this.tree[b])==a&&c.push(this.tree[b]);return c};this.hasChildren=function(a){a=typeof a=="object"?a:this.getNodeById(a);return a!==null?this.getNumChildren(a)>0:!1};this.hasParent=
function(a){return(typeof a=="object"?this.getNodeId(a):a)!==null?this.getParentId(node)?!0:!1:!1};this.navigateBack=function(a){a.preventDefault();var c=a.data.st.getParent(a.data.st.current_view||0)||0;a.data.st.view(c,"left")};this.navigateTop=function(a){a.preventDefault();a.data.st.view(0)};this.getParent=function(a){a=typeof a=="object"?a:this.getNodeById(a);return a===null?null:this.getNodeById(this.getParentId(a))};this.skeleton=function(){this.link_top=b('<div class="'+this.opts.btnTopClass+
'">Back to Top</div>').bind("click",{st:this},this.navigateTop);this.link_back=b('<div class="'+this.opts.btnBackClass+'">Back One Level</div>').bind("click",{st:this},this.navigateBack);this.list_container=b('<div class="'+this.opts.listContainerClass+'"></div>');this.bc=b('<div class="'+this.opts.breadcrumbsClass+'"></div>');this.container.html("").append(this.link_top).append(this.link_back).append(this.list_container).after(this.bc)};this.itemSelected=function(a){var c=b(a.target),d=c.val();a.data.st.getSelection();
var e=c.parents("li:first");c.parents("ul:first").find("input:radio").attr("checked",!1);c.attr("checked","checked");e.siblings().removeClass(a.data.st.opts.selectedClass);e.addClass(a.data.st.opts.selectedClass);a.data.st.selectNode(d)};this.drillDown=function(a){a.preventDefault();var c=a.data.target.data("st-value");a.data.st.navigateDown(c)};this.navigateDown=function(a){this.view(a)};this.addData=function(a,c){if(!a.length)throw"Non-array passed into scrollingTree.addData()";for(var b=0;b<data.length;b++)this.tree.push(data[b]);
c&&this.draw()};this.replaceTree=function(a,b){if(!a.length)throw"Non-array passed into scrollingTree.replaceTree()";this.tree=a;b&&this.draw()};this.getSelectionName=function(){var a=this.getNodeById(this.getSelection());return a?this.getNodeName(a):""};this.selectNode=function(a,b){this.current_selection=a;this.container.trigger("nodeSelected");b&&this.draw()};this.getSelection=function(){return this.current_selection};this.container=e;this.bc=this.list_container=this.link_top=this.link_back=this.output=
null;this.tree=d;this.opts=b.extend({},b.scrollingTree.defaults,g);this.current_selection=null;e.data("scrollingTree",this);e=["getNodeId","getParentId","nodeMarkup","getNumChildren","getNodeName","filterNode"];for(d=0;d<e.length;d++)this[e[d]]=this.opts[e[d]];this.selectNode(g.startNode);this.current_view=this.current_selection?this.getParent(this.current_selection):g.startView;this.skeleton();this.draw()}})(jQuery);
