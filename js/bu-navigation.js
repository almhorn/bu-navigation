var bu=bu||{};bu.navigation={};(function(){var e=bu.navigation;e.settings=buNavSettings||{};e.settings.initialTreeData&&"string"===typeof e.settings.initialTreeData&&(e.settings.initialTreeData=JSON.parse(e.settings.initialTreeData))})(jQuery);
(function(e){var l=bu.navigation;l.tree=function(e,c){if("undefined"===typeof e)throw new TypeError("Invalid navigation tree type!");return l.trees[e](c).initialize()};l.trees={base:function(m,c){var b={},c=c||{};b.config=e.extend({},{el:"#navman_container",nodePrefix:"p"},m||{});b.data={treeConfig:{},rollback:void 0};var h=l.settings,k=b.config,i=b.data,j={};b.listenFor=function(a,d){"undefined"===typeof j[a]&&(j[a]=[]);j[a].push(d);return b};b.broadcast=function(a,d){var c;if(j[a])for(c=0;c<j[a].length;c++)j[a][c].apply(b,
d)};var f=b.$el=e(k.el);if(0===f.length)return!1;i.treeConfig={themes:{theme:"classic"},core:{animation:0,html_titles:!0},plugins:"themes json_data ui types dnd crrm".split(" "),types:{types:{"default":{clickable:!0,renameable:!0,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_regular.png"}},page:{clickable:!0,renameable:!1,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+
"/icons/page_regular.png"}},page_excluded:{clickable:!0,renameable:!1,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_hidden.png"}},page_restricted:{clickable:!0,renameable:!1,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_restricted.png"}},page_denied:{clickable:!1,renameable:!1,deletable:!1,creatable:!1,draggable:!1,max_children:-1,
max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_regular.png"}},page_excluded_denied:{clickable:!1,renameable:!1,deletable:!1,creatable:!1,draggable:!1,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_hidden.png"}},page_restricted_denied:{clickable:!1,renameable:!1,deletable:!1,creatable:!1,draggable:!1,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_restricted.png"}},page_excluded_restricted:{clickable:!0,
renameable:!1,deletable:!0,creatable:!0,draggable:!0,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_hidden_restricted.png"}},page_excluded_restricted_denied:{clickable:!1,renameable:!1,deletable:!1,creatable:!1,draggable:!1,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:h.interfacePath+"/icons/page_hidden_restricted.png"}},link:{icon:{image:h.interfacePath+"/icons/page_white_link.png"},max_children:0},link_restricted:{icon:{image:h.interfacePath+
"/icons/page_white_link.png"},max_children:0},link_excluded:{icon:{image:h.interfacePath+"/icons/page_white_link.png"},max_children:0}}},json_data:{data:h.initialTreeData,ajax:{url:h.rpcUrl,type:"POST",data:function(a){return{id:a.attr?a.attr("id"):0}}},progressive_render:!0}};b.initialize=function(){f.jstree(i.treeConfig);return b};b.selectPost=function(a){a=c.getNodeForPost(a);f.jstree("select_node",a)};b.getSelected=function(){var a=f.jstree("get_selected");return c.nodeToPost(a)};b.getPosts=function(){return f.jstree("get_json",
-1)};b.showAll=function(){f.jstree("open_all")};b.hideAll=function(){f.jstree("close_all")};b.insertPost=function(a,d){var g=e.extend({position:"after",which:null,skip_rename:!0,callback:null},d),h=c.postToNode(a);f.jstree("create",g.which,g.position,h,g.callback,g.skip_rename);b.broadcast("insertPost",[a]);return h.attr.id};b.updatePost=function(a){var d=c.getNodeForPost(a);d&&(f.jstree("set_text",d,a.title),d.data("post_content",a.content),d.data("post_title",a.title),d.data("post_status",a.status),
d.data("post_type",a.type),d.data("post_parent",a.parent),d.data("menu_order",a.menu_order),d.data("post_meta",a.meta));b.broadcast("updatePost",[a])};b.removePost=function(a){var d;a&&"undefined"===typeof a?(d=f.jstree("get_selected"),a=c.nodeToPost(d)):d=c.getNodeForPost(a);f.jstree("remove",d);b.broadcast("removePost",[a])};b.getAncestors=function(a){var b=[];c.getNodeForPost(a).parentsUntil(f,"li").each(function(){b.push(c.nodeToPost(e(this)))});return b};b.save=function(){i.rollback=f.jstree("get_rollback")};
b.restore=function(){i.rollback.d.ui.selected=e([]);e.jstree.rollback(i.rollback)};c.nodeToPost=function(a){if("undefined"===typeof a)throw new TypeError("Invalid node argument!");var b=a.attr("id");-1===b.indexOf("post-new")&&(b=c.stripNodePrefix(b));return{ID:b,title:f.jstree("get_text",a),content:a.data("post_content"),status:a.data("post_status"),type:a.data("post_type"),parent:a.data("post_parent"),menu_order:a.data("menu_order"),meta:a.data("post_meta")||{}}};c.postToNode=function(a,b){if("undefined"===
typeof a)throw new TypeError("Invalid post argument!");e.extend({},{hasChildren:!1,parentId:0},b||{});var g={ID:c.getNextPostID(),title:"Untitled Post",content:"",status:"new",type:"page",parent:0,menu_order:0,meta:{}},g=e.extend({},g,a);return{attr:{id:g.ID?k.nodePrefix+g.ID:"post-new-"+g.ID,rel:g.type},data:{title:g.title},metadata:{post_status:g.status,post_type:g.type,post_content:g.content,post_meta:g.meta}}};c.getNodeForPost=function(a){if("undefined"===typeof a)throw new TypeError("Invalid post argument!");
a=a&&"object"===typeof a?a.ID:a;-1===a.indexOf("post-new")&&(a=k.nodePrefix+a);a=e.jstree._reference(f)._get_node("#"+a);return a.length?a:!1};c.getNextPostID=function(){return e('[id*="post-new-"]').length};c.appendPostStatus=function(a){var b=a.data("post_status")||"publish";"publish"!=b&&a.children("a").after('<span class="post_status '+b+'">'+b+"</span>")};c.stripNodePrefix=function(a){return a.replace(k.nodePrefix,"")};f.bind("loaded.jstree",function(){b.broadcast("postsLoaded")});f.bind("reselect.jstree",
function(){b.broadcast("postsSelected")});f.bind("clean_node.jstree",function(a,b){var g=b.rslt.obj;g&&-1!=g&&g.each(function(a,b){var d=e(b);d.data("meta-loaded")||(c.appendPostStatus(d),d.data("meta-loaded",!0))})});f.bind("create_node.jstree",function(a,d){var g=c.nodeToPost(d.rslt.obj);b.broadcast("postCreated",[g])});f.bind("select_node.jstree",function(a,d){var g=c.nodeToPost(d.rslt.obj);b.broadcast("selectPost",[g])});f.bind("deselect_node.jstree",function(a,d){var g=c.nodeToPost(d.rslt.obj);
b.broadcast("deselectPost",[g])});return b},navman:function(e,c){var b={},c=c||{},b=l.trees.base(e,c),h=b.data;h.treeConfig.plugins.push("contextmenu");h.treeConfig.contextmenu={items:function(){return{edit:{label:"Edit",action:k,icon:"remove"},remove:{label:"Remove",action:i}}}};var k=function(e){e=c.nodeToPost(e);b.broadcast("editPost",[e])},i=function(e){e=c.nodeToPost(e);b.removePost(e)};return b},edit_post:function(m,c){var c=c||{},b=l.trees.base(m,c),h=b.data,k=e.extend(b.config,m||{}),i=l.settings,
j=b.$el,f=k.nodePrefix+i.currentPost,a={crrm:{move:{check_move:b.checkMove}}},d=[],g=[],n;if(i.currentPost&&(d.push("#"+f),i.ancestors&&i.ancestors.length)){var p=i.ancestors.reverse();for(n=0;n<p.length;n++)g.push("#"+k.nodePrefix+i.ancestors[n])}d.length&&(a.ui={initially_select:d});g.length&&(a.core={initially_open:g});e.extend(!0,h.treeConfig,a);j.bind("before.jstree",function(a,b){switch(b.func){case "select_node":if("string"==typeof b.args[0]&&"#"+f!=b.args[0]||b.args[0]instanceof HTMLElement&&
f!=e(b.args[0]).parent("li").attr("id")||b.args[0]instanceof jQuery&&f!=b.args[0].attr("id"))return!1;break;case "deselect_node":if(f==e(b.args[0]).parent("li").attr("id"))return!1;break;case "hover_node":case "start_drag":var c=e(b.args[0]);if(f!=c.parent("li").attr("id"))return!1}});j.bind("move_node.jstree",function(a,e){var d=e.rslt.np,g=e.rslt.o.index()+1,d=j.attr("id")==d.attr("id")?0:parseInt(c.stripNodePrefix(d.attr("id")),10),f=c.nodeToPost(e.rslt.o);f.parent=d;f.menu_order=g;b.updatePost(f);
b.broadcast("postMoved",[f,d,g])});b.checkMove=function(a){a.np.attr("id");return i.currentPost!=a.o.attr("id")||-1===a.cr&&!l.settings.allowTop?!1:!0};b.getCurrentPost=function(){if(null===i.currentPost||"undefined"===typeof i.currentPost)return!1;var a=c.getNodeForPost(i.currentPost);return c.nodeToPost(a)};b.setCurrentPost=function(a){var d=c.getNodeForPost(a);i.currentPost=a.ID;f=d.attr("id");b.selectPost(a)};return b}}})(jQuery);