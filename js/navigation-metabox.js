if("undefined"===typeof bu||"undefined"===typeof bu.plugins||"undefined"===typeof bu.plugins.navigation)throw new TypeError("BU Navigation Metabox dependencies have not been met!");
(function(b){bu.plugins.navigation.views=bu.plugins.navigation.views||{};var c;bu.plugins.navigation.views.Metabox={el:"#bupageparentdiv",ui:{treeContainer:"#edit_page_tree",moveBtn:"#select-parent",breadcrumbs:"#bu_nav_attributes_location_breadcrumbs"},inputs:{label:"#bu-page-navigation-label",visible:"#bu-page-navigation-display",parent:'[name="parent_id"]',order:'[name="menu_order"]'},data:{modalTree:void 0,breadcrumbs:"",label:""},initialize:function(a){a=a||{};this.settings=b.extend({},bu.plugins.navigation.settings,
a);"undefined"===typeof this.settings.isNewPost&&(this.settings.isNewPost=1==b("#auto_draft").val()?!0:!1);this.settings.isNewPost&&(this.settings.currentPost=b("#post_ID").val());this.$el=b(this.el);this.attachHandlers()},loadNavTree:function(){"undefined"===typeof this.data.modalTree&&(this.data.modalTree=ModalPostTree({treeContainer:this.ui.treeContainer,currentPost:this.settings.currentPost,ancestors:this.settings.ancestors,isNewPost:this.settings.isNewPost}),this.data.modalTree.listenFor("update",
b.proxy(this.updateLocation,this)))},attachHandlers:function(){this.$el.delegate(this.ui.moveBtn,"click",b.proxy(this.loadNavTree,this));this.$el.delegate(this.inputs.label,"blur",b.proxy(this.onLabelChange,this));this.$el.delegate(this.inputs.visible,"click",b.proxy(this.onToggleVisibility,this))},onLabelChange:function(){var a=b(this.inputs.label).attr("value"),a={ID:this.settings.currentPost,title:a};c.updatePost(a);c.save();this.updateBreadcrumbs(a)},onToggleVisibility:function(){},updateLocation:function(a){this.updateBreadcrumbs(a);
b(this.inputs.parent).val(a.parent);b(this.inputs.order).val(a.menu_order)},updateBreadcrumbs:function(a){var a=c.getAncestors(a.ID),d=a.join("&nbsp;&raquo;&nbsp;");1<a.length?b(this.ui.breadcrumbs).html("<p>"+d+"</p>"):b(this.ui.breadcrumbs).html("<p>Top level page</p>")}};ModalPostTree=bu.plugins.navigation.views.ModalPostTree=function(a){var d={},e=d.conf={treeContainer:"#edit_page_tree",toolbarContainer:".page_location_toolbar",navSaveBtn:"#bu_page_parent_save",navCancelBtn:"#bu_page_parent_cancel",
currentPost:void 0,isNewPost:!1},e=b.extend(e,a);b.extend(!0,d,bu.signals);d.onUpdateLocation=function(b){b.preventDefault();d.broadcast("update",[c.getCurrentPost()]);c.save();tb_remove()};d.onCancelMove=function(b){b.preventDefault();tb_remove()};d.onPostsSelected=function(){if(e.isNewPost&&!c.getCurrentPost()){var a={ID:e.currentPost,title:b('input[name="nav_label"]').val()||"Untitled post",parent:0,menu_order:0};c.insertPost(a,{position:"before"});c.setCurrentPost(a)}c.save()};c=bu.plugins.navigation.tree("edit_post",
{el:e.treeContainer});c.listenFor("postsSelected",d.onPostsSelected);a=b(e.toolbarContainer);a.delegate(e.navSaveBtn,"click",d.onUpdateLocation);a.delegate(e.navCancelBtn,"click",d.onCancelMove);tb_position();var f=window.tb_remove;window.tb_remove=function(){f();c.restore()};return d}})(jQuery);var tb_position;
(function(b){tb_position=function(){var c=b("#TB_window"),a=b(window).width(),d=b(window).height(),e=720<a?720:a;c.size()&&(c.width(e-50).height(d-45),b("#TB_inline").width(e-80).height(d-90),c.css({"margin-left":"-"+parseInt((e-50)/2,10)+"px"}),"undefined"!=typeof document.body.style.maxWidth&&c.css({top:"20px","margin-top":"0"}));return b("a.thickbox").each(function(){var a=b(this).attr("href");a&&(a=a.replace(/&width=[0-9]+/g,""),a=a.replace(/&height=[0-9]+/g,""),b(this).attr("href",a+"&width="+
(e-80)+"&height="+(d-85)))})};b(window).resize(function(){tb_position()})})(jQuery);jQuery(document).ready(function(){bu.plugins.navigation.views.Metabox.initialize()});