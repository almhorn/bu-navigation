var tb_position;
(function(b){tb_position=function(){var e=b("#TB_window"),f=b(window).width(),c=b(window).height(),a=720<f?720:f;e.size()&&(e.width(a-50).height(c-45),b("#TB_inline").width(a-80).height(c-90),e.css({"margin-left":"-"+parseInt((a-50)/2,10)+"px"}),"undefined"!=typeof document.body.style.maxWidth&&e.css({top:"20px","margin-top":"0"}));return b("a.thickbox").each(function(){var g=b(this).attr("href");g&&(g=g.replace(/&width=[0-9]+/g,""),g=g.replace(/&height=[0-9]+/g,""),b(this).attr("href",g+"&width="+
(a-80)+"&height="+(c-85)))})};b(window).resize(function(){tb_position()})})(jQuery);
jQuery(document).ready(function(b){if(!("undefined"===typeof bu||"undefined"===typeof bu.navigation||"undefined"===typeof bu.navigation.settings)){"undefined"===typeof bu.navigation.views&&(bu.navigation.views={});bu.navigation.views.reposition_post=function(c){var a={conf:{tree_id:"#bu_nav_tree",post_id:0,ancestors:[],is_section_editor:!1,allow_top_level:!1,initial_data:null},data:{settings:null,post_id:null,post:null,id:null,inst:null,rollback:null,tree_conf:null,is_new_post:!1}},g=function(a){var b=
a.data("post_status")||"publish";"publish"!=b&&a.children("a").after('<span class="post_status '+b+'">'+b+"</span>")};a.save=function(){a.data.rollback=b.jstree._reference(a.data.id).get_rollback()};a.restore=function(){a.data.rollback.d.ui.selected=b([]);b.jstree.rollback(a.data.rollback);a.data.rollback=b.jstree._reference(a.data.id).get_rollback()};a.set_post_label=function(c,d){b.jstree._reference(a.data.id).set_text(post_id_to_node_id(c),d)};a.post_id_to_node_id=function(a){return"p"+a};a.node_id_to_post_id=
function(a){return a.substr(1)};a.before=function(c,d){switch(d.func){case "select_node":if("string"==typeof d.args[0]&&"#"+a.data.post_id!=d.args[0]||d.args[0]instanceof HTMLElement&&a.data.post.attr("id")!=b(d.args[0]).parent("li").attr("id")||d.args[0]instanceof jQuery&&a.data.post.attr("id")!=d.args[0].attr("id"))return!1;break;case "deselect_node":if(a.data.post.attr("id")==b(d.args[0]).parent("li").attr("id"))return!1;break;case "hover_node":case "start_drag":var h=b(d.args[0]);if(a.data.post.attr("id")!=
h.parent("li").attr("id"))return!1}};a.on_load_posts=function(c,d){if(a.data.is_new_post){var h=b('input[name="nav_label"]').val()||"Untitled post",h={attr:{id:a.data.post_id},data:h},e=d.inst._get_node("ul > li:first");d.inst.create_node(e,"before",h)}};a.on_reselect=function(){null===a.data.post&&(a.data.post=b("#"+a.data.post_id));a.save()};a.on_clean_post=function(a,d){var c=d.rslt.obj;c&&-1!=c&&c.each(function(a,c){var d=b(c);d.data("meta-loaded")||(g(d),d.data("meta-loaded",!0))})};a.check_move=
function(b){b.np.attr("id");return a.data.post_id!=b.o.attr("id")?!1:-1==b.cr&&(a.conf.is_section_editor||!a.conf.allow_top_level)?(console.log("Move denied, top level posts cannot be created!"),!1):a.conf.is_section_editor&&(b.o.hasClass("denied")||b.np.hasClass("denied"))?!1:!0};a.on_move_post=function(c,d){var e=d.rslt.np,g=d.rslt.o.index()+1,f;f=a.data.id==e.attr("id")?0:e.attr("id").substr(1);e=0<f?d.inst.get_text(e):"";b('[name="tmp_parent_id"]').val(f);b('[name="tmp_menu_order"]').val(g);b('[name="tmp_parent_label"]').val(e)};
a.on_create_post=function(c,d){d.rslt.obj.attr("id")==a.data.post_id&&(a.data.post=b("#"+a.data.post_id),a.data.post.data("post_status","new"),g(a.data.post),d.inst.select_node(a.data.post),a.save())};b.extend(a.conf,c);a.data.id=a.conf.tree_id;a.data.inst=b(a.conf.tree_id);var e;if(a.conf.post_id){if(a.data.post_id=a.post_id_to_node_id(a.conf.post_id),e=["#"+a.data.post_id],c=[],a.conf.ancestors)for(var i=a.conf.ancestors.length-1;0<=i;i--)c.push("#"+a.post_id_to_node_id(a.conf.ancestors[i]))}else a.data.post_id=
b('input[name="post_ID"]').val()||"0",a.data.post_id=a.post_id_to_node_id(a.data.post_id),a.data.is_new_post=!0,c=[],e=[];var i=bu.navigation.get_default_tree_settings({initialTree:a.conf.initial_data}),f={crrm:{move:{check_move:a.check_move}}};c.length&&(f.core={initially_open:c});e.length&&(f.ui={initially_select:e});a.data.settings=b.extend(!0,f,i);a.data.inst.jstree(a.data.settings);a.data.inst.bind("before.jstree",a.before);a.data.inst.bind("loaded.jstree",a.on_load_posts);a.data.inst.bind("reselect.jstree",
a.on_reselect);a.data.inst.bind("clean_node.jstree",a.on_clean_post);a.data.inst.bind("move_node.jstree",a.on_move_post);a.data.inst.bind("create_node.jstree",a.on_create_post);return a};tb_position();var e;e=bu.navigation.views.reposition_post({tree_id:"#edit_page_tree",post_id:bu.navigation.settings.currentPage,ancestors:bu.navigation.settings.ancestors,is_section_editor:bu.navigation.settings.isSectionEditor,allow_top_level:bu.navigation.settings.allowTop,initial_data:bu.navigation.settings.tree});
b('input[name="nav_label"]').blur(function(){b(this).val()});b("#bu_page_parent_save").click(function(c){c.preventDefault();b('[name="parent_id"]').val(b('[name="tmp_parent_id"]').val());b('[name="menu_order"]').val(b('[name="tmp_menu_order"]').val());(c=b('[name="tmp_parent_label"]').val())?b("#bu_nav_attributes_location_breadcrumbs").html("<p>Current Parent: <span>"+c+"</span></p>"):b("#bu_nav_attributes_location_breadcrumbs").html("<p>Current Parent: <span>None (top-level page)</span></p>");e.save();
tb_remove()});b("#bu_page_parent_cancel").click(function(c){c.preventDefault();b('[name="tmp_parent_id"]').val("");b('[name="tmp_menu_order"]').val("");b('[name="tmp_parent_label"]').val("");tb_remove()});var f=window.tb_remove;window.tb_remove=function(){f();e.restore()};b("#bu-page-navigation-display").click(function(){})}});