if("undefined"===typeof bu||"undefined"===typeof bu.navigation)throw new TypeError("BU Navigation Metabox dependencies have not been met!");
(function(a){bu.navigation.views=bu.navigation.views||{};var e,f;e=bu.navigation.views.Metabox={el:"#bupageparentdiv",ui:{treeContainer:"#edit_page_tree",moveBtn:"#select-parent",breadcrumbs:"#bu_nav_attributes_location_breadcrumbs"},inputs:{label:"#bu-page-navigation-label",visible:"#bu-page-navigation-display",parent:'[name="parent_id"]',order:'[name="menu_order"]'},data:{modalTree:void 0,breadcrumbs:"",label:""},initialize:function(b){b=b||{};this.settings=a.extend({},bu.navigation.settings,b);
this.$el=a(this.el);this.loadNavTree();this.attachHandlers()},loadNavTree:function(){var b="1"==a("#auto_draft").val()?!0:!1,d=b?a("#post_ID").val():this.settings.currentPost;this.data.modalTree=ModalPostTree({treeContainer:this.ui.treeContainer,currentPost:d,ancestors:this.settings.ancestors,isNewPost:b})},attachHandlers:function(){this.$el.delegate(this.inputs.label,"blur",this.onLabelChange);this.$el.delegate(this.inputs.visible,"click",this.onToggleVisibility);a(document.body).bind("navigation:post-moved",
this.updateLocation)},onLabelChange:function(){},onToggleVisibility:function(){},updateLocation:function(b,d){var c=d.post;e.updateBreadcrumbs(c);a(e.inputs.parent).val(c.parent);a(e.inputs.order).val(c.menu_order)},updateBreadcrumbs:function(b){b=f.getAncestors(b.ID);(b=a.map(b.reverse(),function(a){return a.title}).join(" > "))?a(e.ui.breadcrumbs).html("<p>"+b+"</p>"):a(e.ui.breadcrumbs).html("<p>Top Level Page</p>")}};ModalPostTree=bu.navigation.views.ModalPostTree=function(b){var d={},c=d.conf=
{treeContainer:"#edit_page_tree",toolbarContainer:".page_location_toolbar",navSaveBtn:"#bu_page_parent_save",navCancelBtn:"#bu_page_parent_cancel",currentPost:void 0,isNewPost:!1},c=a.extend(c,b);d.onUpdateLocation=function(b){b.preventDefault();a(document.body).trigger("navigation:post-moved",{post:f.getCurrentPost()});f.save();tb_remove()};d.onCancelMove=function(a){a.preventDefault();tb_remove()};d.onPostsSelected=function(){if(c.isNewPost&&!f.getCurrentPost()){var b={ID:c.currentPost,title:a('input[name="nav_label"]').val()||
"Untitled post",parent:0,menu_order:0};f.insertPost(b,{position:"before"});f.setCurrentPost(b)}f.save()};f=bu.navigation.tree("edit_post",{el:c.treeContainer});f.listenFor("postsSelected",d.onPostsSelected);b=a(c.toolbarContainer);b.delegate(c.navSaveBtn,"click",d.onUpdateLocation);b.delegate(c.navCancelBtn,"click",d.onCancelMove);tb_position();var e=window.tb_remove;window.tb_remove=function(){e();f.restore()};return d}})(jQuery);var tb_position;
(function(a){tb_position=function(){var e=a("#TB_window"),f=a(window).width(),b=a(window).height(),d=720<f?720:f;e.size()&&(e.width(d-50).height(b-45),a("#TB_inline").width(d-80).height(b-90),e.css({"margin-left":"-"+parseInt((d-50)/2,10)+"px"}),"undefined"!=typeof document.body.style.maxWidth&&e.css({top:"20px","margin-top":"0"}));return a("a.thickbox").each(function(){var c=a(this).attr("href");c&&(c=c.replace(/&width=[0-9]+/g,""),c=c.replace(/&height=[0-9]+/g,""),a(this).attr("href",c+"&width="+
(d-80)+"&height="+(b-85)))})};a(window).resize(function(){tb_position()})})(jQuery);jQuery(document).ready(function(){bu.navigation.views.Metabox.initialize()});